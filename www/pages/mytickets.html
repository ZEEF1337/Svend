<template>
    <div class="page" data-name="mytickets">
        <div class="box">
            <div class="boxcontent">
                <div class="header">
                    <p>Mine tickets</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 10%;">DATO</th>
                            <th>TITEL</th>
                            <th style="width: 10%;">KATEGORI</th>
                            <th style="width: 10%;">STATUS</th>
                            <th style="width:5%;"></th>
                        </tr>
                    </thead>
                    <tbody class="tickettabelbody">
                    </tbody>
                </table>
                <button @click="go2Overview" class="btn">Tilbage</button>
            </div>
        </div>
    </div>
</template>

<script>

    inspectticket = (ticketID) => {
        app.views.main.router.navigate(`/inspectticket/${ticketID}/`, { reloadCurrent: true, });
    }

    return {

        /**
         * Det datasæt som framework7 bruger internt i dette view, de kan ikke tilgås udefra.
         */
        data: function () {
            return {
            };
        },

        // Framework7 Component Methods
        methods: {
            go2Overview(){
                app.views.main.router.navigate("/overview/", { reloadCurrent: true, })
            },
        },
        on: {
            //pageMounted trigger når siden bliver insat i DOMen
            pageMounted: function (page) {
                app.request.getJSON(`${app.data['serverIP']}getMyTickets.php?token=${app.data['sessionToken']}`, {}, function (response) {
                    if (response.result == 1) {
                        let innerHTML = "";
                        Object.keys(response.records).forEach((key, index) => {
                            let value = response.records[key];
                            innerHTML +=
                                `
                                <tr>
                                    <td>${value.Dato}</td>
                                    <td>${value.Titel}</td>
                                    <td>${value.Kategori}</td>
                                    <td>${value.Status}</td>
                                    <td style="text-align:center;">
                                        <a onclick="inspectticket(${value.ID})" style="width: 75px;display:inline-block;" class="noSelect inspectbtn">Åben</a>
                                    </td>
                                </tr>
                                `;
                        });
                        $$('.tickettabelbody').html(innerHTML);
                    }
                }, function (e, e2) { console.error(e); console.error(e2) });
            },
            pageAfterOut: function (page) {
            }
        },
    }


</script>